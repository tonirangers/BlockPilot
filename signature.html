<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>BlockPilot — Signature</title>
  <link rel="stylesheet" href="assets/styles.css" />
</head>
<body data-lang="fr">
  <header class="header">
    <div class="container">
      <nav class="nav">
        <a class="brand" href="./fr/#overview" aria-label="BlockPilot">
          <img class="brand__logo" src="logo.png" alt="BlockPilot" />
        </a>

        <button class="navToggle" id="navToggle" type="button" aria-expanded="false">Menu</button>

        <div class="nav__links" aria-label="Navigation">
          <a href="./fr/#performance">Performance</a>
          <a href="./fr/#security">Sécurité</a>
          <a id="navSignature" href="./signature.html">Signature</a>
        </div>

        <div class="lang" aria-label="Language">
          <a class="pill" href="./fr/">FR</a>
          <a class="pill" href="./en/">EN</a>
        </div>
      </nav>
    </div>
  </header>

  <script>
    (function(){
      const params = new URLSearchParams(location.search);
      const stored = (()=>{ try { return localStorage.getItem('bp_lang'); } catch { return null; }})();
      const base = (params.get('lang') || stored || document.documentElement.lang || 'fr').toLowerCase();
      const lang = base.startsWith('en') ? 'en' : 'fr';
      document.documentElement.lang = lang;
      if (document.body) document.body.setAttribute('data-lang', lang);

      if (!params.get('lang')) {
        const url = new URL(location.href);
        url.searchParams.set('lang', lang);
        history.replaceState({}, '', url.toString());
      }

      const updateNavLinks = (lng) => {
        document.querySelectorAll('.nav__links a').forEach(a => {
          const href = a.getAttribute('href');
          if (!href) return;
          try {
            const url = new URL(href, location.href);
            url.searchParams.set('lang', lng);
            a.href = url.toString();
          } catch {}
        });
      };

      const setLang = (lng) => {
        const next = lng === 'en' ? 'en' : 'fr';
        document.documentElement.lang = next;
        if (document.body) document.body.setAttribute('data-lang', next);
        try { localStorage.setItem('bp_lang', next); } catch {}
        const url = new URL(location.href);
        url.searchParams.set('lang', next);
        history.replaceState({}, '', url.toString());
        updateNavLinks(next);
        try { window.dispatchEvent(new StorageEvent('storage', { key:'bp_lang', newValue: next })); } catch {}
      };

      updateNavLinks(lang);
      window.addEventListener('load', () => updateNavLinks(document.body?.dataset?.lang || lang));

      document.querySelectorAll('.lang .pill').forEach(pill => {
        const target = (pill.textContent || '').trim().toLowerCase().startsWith('en') ? 'en' : 'fr';
        try {
          const url = new URL(location.href);
          url.searchParams.set('lang', target);
          pill.href = url.toString();
        } catch {}
        pill.addEventListener('click', (e) => {
          e.preventDefault();
          setLang(target);
        });
      });
    })();
  </script>

  <main class="section section--tight" id="signature">
    <div class="container">
      <div class="signatureIntro">
        <div>
          <h1 class="h1">Signature</h1>
        </div>
      </div>

      <div class="signatureTabs">
        <button class="tabBtn" type="button" data-signature-view="sign">Signer</button>
        <button class="tabBtn" type="button" data-signature-view="verify">Vérifier</button>
      </div>

      <div class="signatureFrames signatureFrames--single">
        <iframe id="signatureFrame" title="Signer" loading="lazy" allowtransparency="true"></iframe>
      </div>
    </div>
  </main>

  <footer class="footer">
    <div class="container">
      <span>© BlockPilot 2025</span>
    </div>
  </footer>

  <script src="./assets/main.js" defer></script>
</body>
</html>
